<app-home-bar></app-home-bar>

<div class="monitor-container">
    <h2>Multimarcas</h2>

    <div class="acciones-monitor">
        <button class="btn btn-secondary" [routerLink]="['/previo']">
            <i class="fas fa-arrow-left"></i> Volver
        </button>
        <button class="btn" (click)="exportarAExcel()"><i class="fas fa-file-excel"></i> Exportar a Excel</button>
        <button class="btn" [routerLink]="['/distribuidores-multimarcas']"><i class="fas fa-users"></i> Distribuidores
            Multimarcas</button>
    </div>

    <div *ngIf="cargando" class="cargando-spinner">
        <div class="spinner"></div>
        <p>Cargando...</p>
    </div>

    <div *ngIf="!cargando && clientesPaginados.length === 0" class="sin-datos">
        <p>No se pudieron cargar los datos o no hay clientes disponibles.</p>
    </div>

    <div class="tabla-contenedor" *ngIf="!cargando && clientesPaginados.length > 0">
        <table class="tabla-previo">
            <thead>
                <tr>
                    <th class="columna-fija fija-clave" style="height: 80px;">
                        <div class="filter-horizontal-container">
                            <span class="filter-label">Clave</span>
                            <app-filtro-previo tipo="clave" placeholder="Buscar clave..." [opciones]="opcionesClave"
                                [estaActivo]="esFiltroActivo('clave')" (aplicarFiltro)="aplicarFiltroClave($event)"
                                (limpiarFiltro)="limpiarFiltroClave()" (filtroClicked)="toggleFiltroClave()">
                            </app-filtro-previo>
                        </div>
                    </th>

                    <th class="columna-fija fija-evac">
                        <div class="filter-horizontal-container">
                            <span class="filter-label">EVAC</span>
                            <app-filtro-previo tipo="evac" placeholder="Buscar EVAC..." [opciones]="opcionesEvac"
                                [estaActivo]="esFiltroActivo('evac')" (aplicarFiltro)="aplicarFiltroEvac($event)"
                                (limpiarFiltro)="limpiarFiltroEvac()" (filtroClicked)="toggleFiltroEvac()">
                            </app-filtro-previo>
                        </div>
                    </th>

                    <th class="columna-fija fija-cliente">
                        <div class="filter-horizontal-container">
                            <span class="filter-label">Cliente - Raz√≥n Social</span>
                            <app-filtro-previo tipo="cliente" placeholder="Buscar cliente..."
                                [opciones]="opcionesCliente" [estaActivo]="esFiltroActivo('cliente')"
                                (aplicarFiltro)="aplicarFiltroCliente($event)" (limpiarFiltro)="limpiarFiltroCliente()"
                                (filtroClicked)="toggleFiltroCliente()">
                            </app-filtro-previo>
                        </div>
                    </th>

                    <!-- Columnas normales (no fijas) -->
                    <th style="min-width: 120px;">Avance GLOBAL</th>
                    <th style="min-width: 140px;">Avance GLOBAL SCOTT</th>
                    <th style="min-width: 140px;">Avance GLOBAL SYNCROS</th>
                    <th style="min-width: 140px;">Avance GLOBAL APPAREL</th>
                    <th style="min-width: 140px;">Avance GLOBAL VITTORIA</th>
                    <th style="min-width: 120px;">BOLD Acumulado</th>
                    <th style="min-width: 100px;">JULIO 25</th>
                    <th style="min-width: 100px;">AGOSTO 25</th>
                    <th style="min-width: 100px;">SEPTIEMBRE 25</th>
                    <th style="min-width: 100px;">OCTUBRE 25</th>
                    <th style="min-width: 100px;">NOVIEMBRE 25</th>
                    <th style="min-width: 100px;">DICIEMBRE 25</th>
                    <th style="min-width: 100px;">ENERO 26</th>
                    <th style="min-width: 100px;">FEBRERO 26</th>
                    <th style="min-width: 100px;">MARZO 26</th>
                    <th style="min-width: 100px;">ABRIL 26</th>
                    <th style="min-width: 100px;">MAYO 26</th>
                    <th style="min-width: 100px;">JUNIO 26</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let cliente of clientesPaginados">
                    <td class="columna-fija fija-clave">{{ cliente.clave }}</td>
                    <td class="columna-fija fija-evac">{{ cliente.evac }}</td>
                    <td class="columna-fija fija-cliente">{{ cliente.cliente_razon_social }}</td>

                    <td>
                        {{
                        formatCurrency(
                        (cliente.avance_global_scott || 0) +
                        (cliente.avance_global_syncros || 0) +
                        (cliente.avance_global_apparel || 0) +
                        (cliente.avance_global_vittoria || 0) +
                        (cliente.avance_global_bold || 0)
                        )
                        }}
                    </td>
                    <td>{{ formatCurrency(cliente.avance_global_scott) }}</td>
                    <td>{{ formatCurrency(cliente.avance_global_syncros) }}</td>
                    <td>{{ formatCurrency(cliente.avance_global_apparel) }}</td>
                    <td>{{ formatCurrency(cliente.avance_global_vittoria) }}</td>
                    <td>{{ formatCurrency(cliente.avance_global_bold) }}</td>
                    <td>{{ formatCurrency(cliente.total_facturas_julio) }}</td>
                    <td>{{ formatCurrency(cliente.total_facturas_agosto) }}</td>
                    <td>{{ formatCurrency(cliente.total_facturas_septiembre) }}</td>
                    <td>{{ formatCurrency(cliente.total_facturas_octubre) }}</td>
                    <td>{{ formatCurrency(cliente.total_facturas_noviembre) }}</td>
                    <td>{{ formatCurrency(cliente.total_facturas_diciembre) }}</td>
                    <td>{{ formatCurrency(cliente.total_facturas_enero) }}</td>
                    <td>{{ formatCurrency(cliente.total_facturas_febrero) }}</td>
                    <td>{{ formatCurrency(cliente.total_facturas_marzo) }}</td>
                    <td>{{ formatCurrency(cliente.total_facturas_abril) }}</td>
                    <td>{{ formatCurrency(cliente.total_facturas_mayo) }}</td>
                    <td>{{ formatCurrency(cliente.total_facturas_junio) }}</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>