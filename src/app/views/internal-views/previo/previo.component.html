<app-home-bar></app-home-bar>

<div class="monitor-container">
  <h2>Monitor Previo de Facturas</h2>

  <div class="acciones-monitor">
    <button class="btn" [routerLink]="['/monitor']"><i class="fas fa-folder-open"></i> Monitor</button>
    <button class="btn" [routerLink]="['/distribuidores']"><i class="fas fa-file-alt"></i> Distribuidores</button>
    <button class="btn" [routerLink]="['/metas']"><i class="fas fa-bullseye"></i> Metas</button>
    <button class="btn" [routerLink]="['/graficas']"><i class="fas fa-chart-bar"></i> Gráficas</button>
    <button class="btn" [routerLink]="['/caratulas']"><i class="fas fa-book"></i> Carátulas</button>
  </div>

  <div *ngIf="cargando" class="cargando-spinner">
    <div class="spinner"></div>
    <p>Cargando...</p>
  </div>

  <div *ngIf="!cargando && clientesPaginados.length === 0 && integrales.length === 0" class="sin-datos">
    <p>No se pudieron cargar los datos o no hay clientes disponibles.</p>
  </div>

  <div class="tabla-contenedor" *ngIf="!cargando && (clientesPaginados.length > 0 || integrales.length > 0)">
    <table class="tabla-previo">
      <thead>
        <tr>
          <th style="min-width: 130px;">Clave</th>
          <th style="min-width: 80px;">EVAC</th>
          <th style="min-width: 250px;">Cliente - Razón Social</th>
          <th style="min-width: 140px;">Acumulado Compra Anticipada</th>
          <th style="min-width: 140px;">Elección NIVEL</th>
          <th style="min-width: 110px;">Nivel Cierre Compra Inicial</th>
          <th style="min-width: 120px;">Compra Mínima ANUAL</th>
          <th>%</th>
          <th style="min-width: 120px;">Compra Mínima INICIAL</th>
          <th style="min-width: 80px;">Avance GLOBAL</th>
          <th>%</th>
          <th style="min-width: 120px;">Compromiso SCOTT</th>
          <th style="min-width: 120px;">Avance GLOBAL SCOTT</th>
          <th>%</th>
          <th style="min-width: 100px;">Compromiso JUL-AGO</th>
          <th style="min-width: 100px;">Avance</th>
          <th>%</th>
          <th style="min-width: 100px;">Compromiso SEPT-OCT</th>
          <th style="min-width: 120px;">Avance</th>
          <th>%</th>
          <th style="min-width: 100px;">Compromiso NOV-DIC</th>
          <th style="min-width: 120px;">Avance</th>
          <th>%</th>
          <th style="min-width: 120px;">Compromiso APPAREL, SYNCROS, VITTORIA</th>
          <th style="min-width: 120px;">Avance GLOBAL</th>
          <th>%</th>
          <th style="min-width: 100px;">Compromiso JUL-AGO</th>
          <th style="min-width: 120px;">Avance</th>
          <th>%</th>
          <th style="min-width: 100px;">Compromiso SEPT-OCT</th>
          <th style="min-width: 120px;">Avance</th>
          <th>%</th>
          <th style="min-width: 100px;">Compromiso NOV-DIC</th>
          <th style="min-width: 120px;">Avance</th>
          <th>%</th>
          <th style="min-width: 120px;">SYNCROS Acumulado</th>
          <th style="min-width: 120px;">APPAREL Acumulado</th>
          <th style="min-width: 120px;">VITTORIA Acumulado</th>
          <th style="min-width: 120px;">BOLD Acumulado</th>
        </tr>
      </thead>
      <tbody>
        <!-- Clientes normales -->
        <tr *ngFor="let cliente of clientesPaginados">
          <td>{{ cliente.clave }}</td>
          <td>{{ cliente.evac }}</td>
          <td>{{ cliente.nombre_cliente }}</td>
          <td>{{ cliente.acumulado_anticipado | currency:'USD':'symbol':'1.2-2' }}</td>
          <td>{{ cliente.nivel }}</td>
          <td></td>
          <td>{{ cliente.compra_minima_anual | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>%</td>
          <td>{{ cliente.compra_minima_inicial | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>—</td>
          <td>%</td>
          <td>{{ cliente.compromiso_scott | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>{{ cliente.avance_global_scott | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>%</td>
          <td>{{ cliente.compromiso_jul_ago | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>{{ cliente.avance_jul_ago | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>%</td>
          <td>{{ cliente.compromiso_sep_oct | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>{{ cliente.avance_sep_oct | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>%</td>
          <td>{{ cliente.compromiso_nov_dic | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>{{ cliente.avance_nov_dic | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>%</td>
          <td>{{ cliente.compromiso_apparel_syncros_vittoria | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>—</td>
          <td>%</td>
          <td>{{ cliente.compromiso_jul_ago_app | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>—</td>
          <td>&</td>
          <td>{{ cliente.compromiso_sep_oct_app | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>—</td>
          <td>%</td>
          <td>{{ cliente.compromiso_nov_dic_app | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>—</td>
          <td>%</td>
          <td>—</td>
          <td>—</td>
          <td>—</td>
          <td>—</td>
        </tr>

        <!-- Separador visual para integrales -->
        <tr *ngIf="integrales.length > 0" class="separador-integral">
          <td colspan="38">INTEGRALES</td>
        </tr>

        <!-- Integrales -->
        <tr *ngFor="let integral of integrales" class="fila-integral">
          <td>{{ integral.clave }}</td>
          <td>{{ integral.evac }}</td>
          <td>{{ integral.nombre_cliente }}</td>
          <td>{{ integral.acumulado_anticipado | currency:'USD':'symbol':'1.2-2' }}</td>
          <td>{{ integral.nivel }}</td>
          <td></td>
          <td>{{ integral.compra_minima_anual | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>%</td>
          <td>{{ integral.compra_minima_inicial | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>—</td>
          <td>%</td>
          <td>{{ integral.compromiso_scott | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>{{ integral.avance_global_scott | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>%</td>
          <td>{{ integral.compromiso_jul_ago| currency:'USD':'symbol':'1.0-0' }}</td>
          <td>{{ integral.avance_global_scott | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>%</td>
          <td>{{ integral.compromiso_sep_oct | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>{{ integral.avance_sep_oct | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>%</td>
          <td>{{ integral.compromiso_nov_dic | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>{{ integral.avance_nov_dic | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>%</td>
          <td>{{ integral.compromiso_apparel_syncros_vittoria | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>—</td>
          <td>%</td>
          <td>{{ integral.compromiso_jul_ago_app | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>—</td>
          <td>%</td>
          <td>{{ integral.compromiso_sep_oct_app | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>—</td>
          <td>%</td>
          <td>{{ integral.compromiso_nov_dic_app | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>—</td>
          <td>%</td>
          <td>—</td>
          <td>—</td>
          <td>—</td>
          <td>—</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="paginador" *ngIf="totalPaginas > 1">
    <button (click)="cambiarPagina(1)" [disabled]="paginaActual === 1">« Primera</button>
    <button (click)="cambiarPagina(paginaActual - 1)" [disabled]="paginaActual === 1">‹ Anterior</button>
    <span class="paginador-info">
      Página
      <input type="number" min="1" [max]="totalPaginas" [(ngModel)]="paginaActualTemp"
        (keyup.enter)="cambiarPagina(paginaActualTemp)" />
      de {{ totalPaginas }}
    </span>
    <button (click)="cambiarPagina(paginaActual + 1)" [disabled]="paginaActual === totalPaginas">Siguiente ›</button>
    <button (click)="cambiarPagina(totalPaginas)" [disabled]="paginaActual === totalPaginas">Última »</button>
  </div>
</div>